;
; unclamp tool, keep the unclamp signal active
;

o<m11> sub

m66 p#<_ini[i]sp_zsp> l3 q1	; spindle stopped?
o1 if [#5399 lt 0]
	(abort, M11 spindle running)
	o<m11> return [-1]
o1 endif

m65 p#<_ini[o]clamp>
m64 p#<_ini[o]unclamp>
m66 p#<_ini[i]unclamped> l3 q3		; make sure the tool is clamped, 3s timeout
o2 if [#5399 lt 0]
	(abort, M11 tool unclamp failed)
	o<m11> return [-1]
o2 endif

; keep unclamp signal active

o<m11> endsub [1]
m2
